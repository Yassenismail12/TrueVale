//Element References
const track = document.querySelector('.carousel-track');
const nextBtn = document.querySelector('.carousel-btn.next');
const prevBtn = document.querySelector('.carousel-btn.prev');
const items = document.querySelectorAll('.exclusive-item');

//Track Position Tracker
let currentIndex = 0;

//Core Function
function updateCarousel() {
  //Item width calculation
  const itemWidth = items[0].offsetWidth + 30;
  //Visible items count
  const visibleCount = Math.floor(document.querySelector('.carousel-window').offsetWidth / itemWidth) + 1;
  //Max scroll index
  const maxIndex = items.length - visibleCount;
  //Apply the translation
  track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
  //Disable navigation buttons appropriately
  prevBtn.disabled = currentIndex === 0;
  nextBtn.disabled = currentIndex >= maxIndex;
}
//Event Listeners for Navigation
nextBtn.addEventListener('click', () => {
  currentIndex++;
  updateCarousel();
});

prevBtn.addEventListener('click', () => {
  currentIndex--;
  updateCarousel();
});
//Responsiveness  
window.addEventListener('resize', updateCarousel);
window.addEventListener('load', updateCarousel);

// Button navigation
var shopbttn = document.getElementById('shopbttn');
shopbttn.onclick = function() {
  location.assign('/Products/products.html');
}

// Search form handling
document.addEventListener("DOMContentLoaded", () => {
  const searchForm = document.getElementById("searchForm");
  const searchInput = document.getElementById("searchInput");

  if (searchForm) {
    searchForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const query = searchInput.value.trim();
      if (query) {
        window.location.href = `Products/products.html?search=${encodeURIComponent(query)}`;
      } else {
        window.location.href = "Products/products.html";
      }
    });
  }
});

// Category filter redirect
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('[data-category]').forEach(link => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      const category = e.currentTarget.dataset.category;
      if (category) {
      window.location.href = `Products/products.html?search=${encodeURIComponent(query)}`;
      }
    });
  });
});

// DOMContentLoaded Event Listener
document.addEventListener("DOMContentLoaded", () => {
  // Navbar & Hamburger Menu Variables
  const hamburger = document.getElementById('hamburger');
  const navLinks = document.getElementById('navLinks');
  const overlay = document.getElementById('overlay');
  const navbar = document.getElementById('navbar');
  //Existence Check
  if (hamburger && navLinks && overlay && navbar) {
    // Toggle Menu Functionality
    function toggleMenu() {
      hamburger.classList.toggle('active');
      navLinks.classList.toggle('open');
      overlay.classList.toggle('show');
      const isExpanded = hamburger.classList.contains('active');
      hamburger.setAttribute('aria-expanded', isExpanded);
    }
    // Menu Click + Keyboard Accessibility
    hamburger.addEventListener('click', toggleMenu);
    hamburger.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleMenu();
      }
    });
      //Overlay Click — Close Menu
    overlay.addEventListener('click', () => {
      hamburger.classList.remove('active');
      navLinks.classList.remove('open');
      overlay.classList.remove('show');
      hamburger.setAttribute('aria-expanded', 'false');
    });

    // Mobile Dropdown Toggle
    const dropdowns = document.querySelectorAll('.dropdown > a');
    dropdowns.forEach(dropdown => {
      dropdown.addEventListener('click', (e) => {
        if (window.innerWidth <= 992) {
          e.preventDefault();
          dropdown.parentElement.classList.toggle('active');
        }
      });
    });

    // Navbar Scroll Effect
    window.addEventListener('scroll', () => {
      const currentScroll = window.pageYOffset;
      if (currentScroll > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    });

    // Close menu on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && navLinks.classList.contains('open')) {
        hamburger.classList.remove('active');
        navLinks.classList.remove('open');
        overlay.classList.remove('show');
      }
    });
  }

  // Voice Search (Mock) – safe check
  const voiceBtn = document.getElementById('voiceSearchBtn');
  const searchInput = document.getElementById('searchInput');
  // Voice Recognition Setup
  if (voiceBtn && searchInput) {
    voiceBtn.addEventListener('click', () => {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.continuous = false;
// Listening Feedback + Handling Result
        voiceBtn.classList.add('listening');

        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          searchInput.value = transcript;
          voiceBtn.classList.remove('listening');
        };
//Error and cleanup
        recognition.onerror = () => {
          voiceBtn.classList.remove('listening');
        };

        recognition.onend = () => {
          voiceBtn.classList.remove('listening');
        };

        recognition.start();
      } else {
        alert('Voice search is not supported in your browser.');
      }
    });

    // Search Form Handler
    const searchForm = document.getElementById('searchForm');
    if (searchForm) {
      searchForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const query = searchInput.value.trim();
        if (query) {
          console.log('Searching for:', query);
        }
      });
    }
  }
});
//Category Redirection 
document.querySelectorAll('.dropdown-menu a[data-category]').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const category = e.target.getAttribute('data-category');
    window.location.href = `/Products/products.html?category=${encodeURIComponent(category)}`;
  });
});

// "Be a Seller"
document.querySelector('.seller-btn').addEventListener('click', () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});
